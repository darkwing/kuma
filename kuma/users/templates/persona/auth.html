<script src="https://login.persona.org/include.js"></script>
<script type="text/javascript">
(function($) {
  mdn.allauth.persona = {
    login: function(nextUrl, process) {
        $('#_persona_next_url').val(nextUrl || '');
        $('#_persona_process').val(process);
        $.get("{{ url('persona_csrf_token') }}").then(function(token) {
            $('#_persona_csrf_token').val(token);
        });
        navigator.id.watch({
          onlogin: function(assertion) {
            // TODO: next url handling
            $('#_persona_assertion').val(assertion);
            $('#_persona_login').submit();
          }
        });
        navigator.id.request({{ request_parameters|safe }});
    }
  }
})(jQuery);
</script>

<form id="_persona_login" method="post" action="{{ url('persona_login') }}">
  <input type="hidden" name="csrfmiddlewaretoken" value="" id="_persona_csrf_token" />
  <input type="hidden" name="next" value="" id="_persona_next_url"/>
  <input type="hidden" name="process" value="" id="_persona_process"/>
  <input type="hidden" name="assertion" id="_persona_assertion"/>
</form>
